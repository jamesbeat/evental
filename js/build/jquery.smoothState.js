!function($,window,document){"use strict";if(!history.pushState)return $.fn.smoothState=function(){return this},void($.fn.smoothState.options={});if(!$.fn.smoothState){var $body=$("html, body"),consl=window.console||!1,defaults={anchors:"a",prefetch:!1,blacklist:".no-smoothstate, [target]",development:!1,pageCacheSize:0,alterRequestUrl:function(url){return url},onStart:{duration:0,render:function(){$body.scrollTop(0)}},onProgress:{duration:0,render:function(){$body.css("cursor","wait"),$body.find("a").css("cursor","wait")}},onEnd:{duration:0,render:function(url,$container,$content){$body.css("cursor","auto"),$body.find("a").css("cursor","auto"),$container.html($content)}},callback:function(){}},utility={isExternal:function(url){var match=url.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return"string"==typeof match[1]&&match[1].length>0&&match[1].toLowerCase()!==window.location.protocol?!0:"string"==typeof match[2]&&match[2].length>0&&match[2].replace(new RegExp(":("+{"http:":80,"https:":443}[window.location.protocol]+")?$"),"")!==window.location.host?!0:!1},isHash:function(url){var hasPathname=url.indexOf(window.location.pathname)>0?!0:!1,hasHash=url.indexOf("#")>0?!0:!1;return hasPathname&&hasHash?!0:!1},shouldLoad:function($anchor,blacklist){var url=$anchor.prop("href");return!utility.isExternal(url)&&!utility.isHash(url)&&!$anchor.is(blacklist)},htmlDoc:function(html){var parent,elems=$(),matchTag=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/gi,prefix="ss"+Math.round(1e5*Math.random()),htmlParsed=html.replace(matchTag,function(tag,slash,name,attrs){var obj={};return slash||($.merge(elems,$("<"+name+"/>")),attrs&&$.each($("<div"+attrs+"/>")[0].attributes,function(i,attr){obj[attr.name]=attr.value}),elems.eq(-1).attr(obj)),"<"+slash+"div"+(slash?"":" id='"+prefix+(elems.length-1)+"'")+">"});return elems.length?(parent||(parent=$("<div/>")),parent.html(htmlParsed),$.each(elems,function(i){var elem=parent.find("#"+prefix+i).before(elems[i]);elems.eq(i).html(elem.contents()),elem.remove()}),parent.children().unwrap()):$(html)},clearIfOverCapacity:function(obj,cap){return Object.keys||(Object.keys=function(obj){var k,keys=[];for(k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return keys}),Object.keys(obj).length>cap&&(obj={}),obj},getContentById:function(id,$html){$html=$html instanceof jQuery?$html:utility.htmlDoc($html);var $insideElem=$html.find(id),updatedContainer=$insideElem.length?$.trim($insideElem.html()):$html.filter(id).html(),newContent=updatedContainer.length?$(updatedContainer):null;return newContent},storePageIn:function(object,url,$html){return $html=$html instanceof jQuery?$html:utility.htmlDoc($html),object[url]={status:"loaded",title:$html.find("title").text(),html:$html},object},triggerAllAnimationEndEvent:function($element,resetOn){resetOn=" "+resetOn||"";var animationCount=0,animationstart="animationstart webkitAnimationStart oanimationstart MSAnimationStart",animationend="animationend webkitAnimationEnd oanimationend MSAnimationEnd",eventname="allanimationend",onAnimationStart=function(e){$(e.delegateTarget).is($element)&&(e.stopPropagation(),animationCount++)},onAnimationEnd=function(e){$(e.delegateTarget).is($element)&&(e.stopPropagation(),animationCount--,0===animationCount&&$element.trigger(eventname))};$element.on(animationstart,onAnimationStart),$element.on(animationend,onAnimationEnd),$element.on("allanimationend"+resetOn,function(){animationCount=0,utility.redraw($element)})},redraw:function($element){$element.height()}},onPopState=function(e){if(null!==e.state){var url=window.location.href,$page=$("#"+e.state.id),page=$page.data("smoothState");page.href===url||utility.isHash(url)||page.load(url,!0)}},SmoothState=function(element,options){var $container=$(element),cache={},currentHref=window.location.href,load=function(url,isPopped){isPopped=isPopped||!1;var hasRunCallback=!1,callbBackEnded=!1,responses={loaded:function(){var eventName=hasRunCallback?"ss.onProgressEnd":"ss.onStartEnd";callbBackEnded&&hasRunCallback?callbBackEnded&&updateContent(url):$container.one(eventName,function(){updateContent(url)}),isPopped||window.history.pushState({id:$container.prop("id")},cache[url].title,url)},fetching:function(){hasRunCallback||(hasRunCallback=!0,$container.one("ss.onStartEnd",function(){options.onProgress.render(url,$container,null),setTimeout(function(){$container.trigger("ss.onProgressEnd"),callbBackEnded=!0},options.onStart.duration)})),setTimeout(function(){cache.hasOwnProperty(url)&&responses[cache[url].status]()},10)},error:function(){window.location=url}};cache.hasOwnProperty(url)||fetch(url),options.onStart.render(url,$container,null),setTimeout(function(){$container.trigger("ss.onStartEnd")},options.onStart.duration),responses[cache[url].status]()},updateContent=function(url){var containerId="#"+$container.prop("id"),$content=cache[url]?utility.getContentById(containerId,cache[url].html):null;$content?(document.title=cache[url].title,$container.data("smoothState").href=url,options.onEnd.render(url,$container,$content),$container.one("ss.onEndEnd",function(){options.callback(url,$container,$content)}),setTimeout(function(){$container.trigger("ss.onEndEnd")},options.onEnd.duration)):!$content&&options.development&&consl?consl.warn("No element with an id of "+containerId+" in response from "+url+" in "+cache):window.location=url},fetch=function(url){if(!cache.hasOwnProperty(url)){cache=utility.clearIfOverCapacity(cache,options.pageCacheSize),cache[url]={status:"fetching"};var requestUrl=options.alterRequestUrl(url)||url,request=$.ajax(requestUrl);request.success(function(html){utility.storePageIn(cache,url,html),$container.data("smoothState").cache=cache}),request.error(function(){cache[url].status="error"})}},hoverAnchor=function(event){var $anchor=$(event.currentTarget),url=$anchor.prop("href");utility.shouldLoad($anchor,options.blacklist)&&(event.stopPropagation(),fetch(url))},clickAnchor=function(event){var $anchor=$(event.currentTarget),url=$anchor.prop("href");event.metaKey||event.ctrlKey||!utility.shouldLoad($anchor,options.blacklist)||(event.stopPropagation(),event.preventDefault(),load(url))},bindEventHandlers=function($element){$element.on("click",options.anchors,clickAnchor),options.prefetch&&$element.on("mouseover touchstart",options.anchors,hoverAnchor)},toggleAnimationClass=function(classname){var classes=$container.addClass(classname).prop("class");$container.removeClass(classes),setTimeout(function(){$container.addClass(classes)},0),$container.one("ss.onStartEnd ss.onProgressEnd ss.onEndEnd",function(){$container.removeClass(classname)})};return options=$.extend({},$.fn.smoothState.options,options),null===window.history.state&&window.history.replaceState({id:$container.prop("id")},document.title,currentHref),utility.storePageIn(cache,currentHref,document.documentElement.outerHTML),utility.triggerAllAnimationEndEvent($container,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd"),bindEventHandlers($container),{href:currentHref,cache:cache,load:load,fetch:fetch,toggleAnimationClass:toggleAnimationClass}},declareSmoothState=function(options){return this.each(function(){this.id&&!$.data(this,"smoothState")?$.data(this,"smoothState",new SmoothState(this,options)):!this.id&&consl&&consl.warn("Every smoothState container needs an id but the following one does not have one:",this)})};window.onpopstate=onPopState,$.smoothStateUtility=utility,$.fn.smoothState=declareSmoothState,$.fn.smoothState.options=defaults}}(jQuery,window,document);
//# sourceMappingURL=jquery.smoothState.map